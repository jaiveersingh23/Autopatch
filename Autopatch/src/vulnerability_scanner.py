import re
import json

def load_signatures():
    with open("data/vulnerability_signatures.json", "r") as f:
        return json.load(f)

def scan_code(file_path):
    signatures = load_signatures()
    vulnerabilities = []

    with open(file_path, "r") as f:
        code_lines = f.readlines()

    for line_number, line in enumerate(code_lines, start=1):
        for vuln_type, pattern in signatures.items():
            if re.search(pattern, line):
                vulnerabilities.append({
                    "line": line_number,
                    "type": vuln_type,
                    "description": f"Potential {vuln_type} vulnerability",
                    "pattern": pattern
                })

    return vulnerabilities
