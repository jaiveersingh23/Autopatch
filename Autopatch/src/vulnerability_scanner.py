import re
import json

# Load vulnerability patterns from the JSON file
with open("data/vulnerability_signatures.json", "r") as f:
    vulnerability_patterns = json.load(f)

def scan_code(file_path):
    """Scans the Python code for known vulnerabilities based on the patterns."""
    with open(file_path, "r") as f:
        code = f.read()

    vulnerabilities = []

    # Check for each vulnerability type in the code
    for vuln_type, pattern in vulnerability_patterns.items():
        matches = re.finditer(pattern, code)
        for match in matches:
            vulnerabilities.append({
                "type": vuln_type,
                "line": code.count("\n", 0, match.start()) + 1,  # Line number based on match
                "description": match.group(0)
            })

    return vulnerabilities
